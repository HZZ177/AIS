# 车位图片上报功能测试用例

## 对应风险点：代码中潜在的问题1：【代码片段】：if not image and not inner_pic:【潜在的问题】：未对image和inner_pic进行有效性验证，例如image是否为空文件，inner_pic是否包含非法字符等【测试点】：测试上传空文件、测试inner_pic包含非法字符的情况

### 用例一：上传空文件
#### 【前置条件】
1. 选择硬识别模式
2. 准备一个0字节的空图片文件
#### 步骤
    ##### 步骤1
    调用车位图片上报接口，上传空图片文件
#### 预期结果
    ##### 预期结果1
    返回400错误码并提示"图片文件不能为空"

### 用例二：inner_pic包含非法字符
#### 【前置条件】
1. 选择使用内置图片
#### 步骤
    ##### 步骤1
    调用车位图片上报接口，inner_pic参数传入"test|pic.jpg"
#### 预期结果
    ##### 预期结果1
    返回400错误码并提示"内置图片名称包含非法字符"

## 对应风险点：代码中潜在的问题2：【代码片段】：if model == 1:【潜在的问题】：未对model参数进行有效性验证，只验证了是否为1，未验证是否为2或其他值【测试点】：测试model传入非法值（如0、3等）的情况

### 用例一：model传入0
#### 【前置条件】
1. 准备有效的车位图片
#### 步骤
    ##### 步骤1
    调用车位图片上报接口，model参数传入0
#### 预期结果
    ##### 预期结果1
    返回400错误码并提示"不支持的识别模式"

### 用例二：model传入3
#### 【前置条件】
1. 准备有效的车位图片
#### 步骤
    ##### 步骤1
    调用车位图片上报接口，model参数传入3
#### 预期结果
    ##### 预期结果1
    返回400错误码并提示"不支持的识别模式"

## 对应风险点：代码中潜在的问题3：【代码片段】：image_bytes = await image.read()【潜在的问题】：未对大文件进行限制，可能导致内存溢出【测试点】：测试上传超大图片文件的情况

### 用例一：上传50MB的图片文件
#### 【前置条件】
1. 准备一个50MB的图片文件
#### 步骤
    ##### 步骤1
    调用车位图片上报接口上传大文件
#### 预期结果
    ##### 预期结果1
    返回413错误码并提示"图片文件过大"

## 对应风险点：代码中潜在的问题4：【代码片段】：plateColor: int = Form(None, ge=1, le=5)【潜在的问题】：未对plateColor为None时进行特殊处理，可能导致后续使用时报错【测试点】：测试软识别模式下plateColor为None的情况

### 用例一：软识别模式下plateColor为None
#### 【前置条件】
1. 选择软识别模式
#### 步骤
    ##### 步骤1
    调用车位图片上报接口，不传plateColor参数
#### 预期结果
    ##### 预期结果1
    接口正常执行，不校验车牌颜色

## 对应风险点：代码中潜在的问题5：【代码片段】：get_inner_picture函数【潜在的问题】：未对inner_pic_name进行路径遍历攻击防护【测试点】：测试inner_pic_name包含../等路径遍历字符的情况

### 用例一：inner_pic_name包含路径遍历字符
#### 【前置条件】
1. 选择使用内置图片
#### 步骤
    ##### 步骤1
    调用车位图片上报接口，inner_pic参数传入"../etc/passwd"
#### 预期结果
    ##### 预期结果1
    返回400错误码并提示"内置图片名称非法"

## 对应风险点：代码中潜在的问题11：【代码片段】：parkNum: int = Form(..., ge=1, le=6)【潜在的问题】：未对parkNum为浮点数的情况进行处理【测试点】：测试parkNum传入浮点数的情况

### 用例一：parkNum传入浮点数
#### 【前置条件】
1. 准备有效的车位图片
#### 步骤
    ##### 步骤1
    调用车位图片上报接口，parkNum参数传入3.14
#### 预期结果
    ##### 预期结果1
    返回400错误码并提示"车位号必须为整数"

## 对应风险点：代码中潜在的问题12：【代码片段】：image: UploadFile = File(None)【潜在的问题】：未对上传文件的类型进行限制【测试点】：测试上传非图片文件的情况

### 用例一：上传txt文件
#### 【前置条件】
1. 准备一个文本文件
#### 步骤
    ##### 步骤1
    调用车位图片上报接口上传txt文件
#### 预期结果
    ##### 预期结果1
    返回400错误码并提示"仅支持图片文件"

## 对应风险点：代码中潜在的问题16：【代码片段】：plateColor参数【潜在的问题】：未考虑车牌颜色与车牌号的匹配关系【测试点】：测试输入不匹配的车牌颜色和车牌号组合

### 用例一：黄色车牌与小型汽车车牌号
#### 【前置条件】
1. 选择硬识别模式
2. 准备有效的车位图片
#### 步骤
    ##### 步骤1
    调用车位图片上报接口，plateColor传入3(黄色)，plateNumber传入小型汽车车牌号
#### 预期结果
    ##### 预期结果1
    返回400错误码并提示"车牌颜色与车牌号不匹配"

## 对应风险点：代码中潜在的问题20：【代码片段】：整体接口【潜在的问题】：未考虑性能测试【测试点】：测试接口响应时间是否符合要求

### 用例一：接口响应时间测试
#### 【前置条件】
1. 准备10个并发的请求
#### 步骤
    ##### 步骤1
    并发调用车位图片上报接口
#### 预期结果
    ##### 预期结果1
    平均响应时间小于500ms